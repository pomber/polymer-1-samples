<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="cg-cloud.html">

<dom-module id="cg-random-cloud">
  <template>

    <cg-cloud coords="[[coords]]"></cg-cloud>
    <pre>[[code]]</pre>

  </template>

  <script>
    Polymer({

      is: 'cg-random-cloud',

      properties: {
        coords: {
          type: Array,
          value: function() {
            return this.generateCoords();
          },
          code: String
        }
      },

      _getCode: function() {
        return JSON.stringify(this.coords);
      },

      generateCoords: function() {
        var coords = [];

        var d0 = getRandom(10, 85);
        var r0 = d0/2; 
        var first = {
          x: 0,
          d: d0,
          r: d0/2,
          y: 100 - d0,
        };

        coords.push(first);

        for (var i = 0; i < 1; i++) {
          var p = coords[i];
          var c = {};
          c.xmin = p.x + p.r;
          c.xmax = p.x + p.d;
          c.x = getRandom(c.xmin, c.xmax);
          c.xd = c.x - p.x;
          c.dmin = p.x + p.d - c.x;
          c.dmax = 100;
          c.d = getRandom(c.dmin, c.dmax);
          c.r = c.d / 2;
          c.s = Math.sqrt(sq(p.r)-sq(c.xd-p.r));
          c.ymin = Math.max(p.y + p.r - c.s - c.r, 0);
          c.ymax = 100;
          c.y = getRandom(c.ymin, c.ymax);
          coords.push(c); 
        }

        this.code = JSON.stringify(coords, null, ' ');

        return coords;
      },

    });

    // Returns a random integer between min (included) and max (included)
    function getRandom(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function sq(x) {
      return x * x;
    }
  </script>
</dom-module>
