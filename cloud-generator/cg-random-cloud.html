<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="cg-cloud.html">

<dom-module id="cg-random-cloud">
  <template>

    <cg-cloud coords="[[coords]]"></cg-cloud>
    <pre>[[code]]</pre>

  </template>

  <script>
    Polymer({

      is: 'cg-random-cloud',

      properties: {
        coords: {
          type: Array,
          value: function() {
            return this.generateCoords();
          },
          code: String
        }
      },

      _getCode: function() {
        return JSON.stringify(this.coords);
      },

      generateCoords: function() {
        var coords = [];

        var d0 = getRandom(10, 85);
        var r0 = d0/2; 
        var first = {
          x: 0,
          d: d0,
          y: 100 - d0,
        };

        coords.push(first);

        var x1 = getRandom(first.x + r0, first.x + d0);
        var mind1 = first.x + d0 - x1;
        var maxd1 = first.x + r0;
        var d1 = getRandom(mind1, maxd1);
        var r1 = d1/2;
        var dx = x1 - first.x;
        var s = Math.sqrt(r0*r0 - ((dx-r0)*(dx-r0)));        
        var miny1 = Math.min(0, first.y + r0 - s - r1);
        var maxy1 = 100;
        var y1 = getRandom(miny1, maxy1);

        coords.push({x:x1, y:y1, d:d1});

        console.log();
        this.code = JSON.stringify(coords, null, ' ');

        return coords;
      },

      generateCoordsOld: function() {
        var parts = 6;
        var xs = [];   

        for (var i = 0; i < parts; i++) {          
          xs.push(getRandom(0, 100));
        }
        
        xs.sort(function (a, b) {  return a - b;  });

        var coords = xs.map(function (x, i) {
          var d = getRandom(0,100);          
          var y = getRandom(0,d);
          if (i == 0 || i == parts - 1) {
            y = 100 - d;
          }
          return {
            x: x,
            y: y,
            d: d
          }
        });

        for (var i = 1; i < parts; i++) {
          var xp = coords[i-1].x;
          var yp = coords[i-1].y;
          var dp = coords[i-1].d;
          var d = coords[i].d;
          var r = d / 2;
          var rp = dp / 2;

          if (i==1) {
            coords[i].x = getRandom(xp + rp, xp + dp);
            coords[i].y = getRandom(yp - r, d);
          } else if (i == parts - 1) {
            coords[i].x = getRandom(xp + dp - r, xp + dp);  
          } else {
            coords[i].x = getRandom(xp, xp + dp);
            coords[i].y = getRandom(yp - r, d);
          }
        }

        console.log(JSON.stringify(coords));

        return coords;

        // return [
        //     {x: 0, y: 37, d: 63},
        //     {x: 20, y: 0, d: 100},
        //     {x: 60, y: 10, d: 40},
        //     {x: 60, y: 20, d: 80},
        // ];
      }

    });

    // Returns a random integer between min (included) and max (included)
    function getRandom(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
  </script>
</dom-module>
